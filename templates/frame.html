<script>
function sha1(a,b){var c=new TextEncoder("utf-8").encode(a);return crypto.subtle.digest("SHA-1",c).then(function(f){b(hex(f))})}function hex(a){for(var b=[],c=new DataView(a),f=0;f<c.byteLength;f+=4){var g=c.getUint32(f),h=g.toString(16),k="00000000",l=(k+h).slice(-k.length);b.push(l)}return b.join("")}var loc=window.location,collectPath="collect",endPoint=loc.protocol+"//"+loc.hostname+(loc.port?":"+loc.port:"")+"/"+collectPath,siteID="",main=function(a){var b=a.href,c=gtUtils.getDate(),f=gtUtils.parseRef(a.ref),g=gtUtils.dateToTimestamp(c),h=g.slice(0,10),k=g.slice(0,8),l=localStorage.getItem("xt:count");l=l?parseInt(l):0,l+=1,localStorage.setItem("xt:count",l);var n=a.origin,p=[];p.push({ts:g,type:"page_load",p:b}),p.push({ts:g,type:"site_load",p:n});var q="000000000000";gtUtils.hashSHA1(n,20,function(N){var O=JSON.parse(localStorage.getItem("gt:site:"+N)||"{\"site\": {}, \"urls\": {}}"),P=JSON.parse(localStorage.getItem("gt:agg_cache_time_by_hour:"+N)||"{}");if(!P[h]){for(var S,Q=Object.keys(P),R=0;R<Q.length;R++)S=Q[R],p.push({ty:"agg_"+n,ts:S,o:P[S]}),delete P[S];P[h]={agg_page_loads:0,agg_page_time:0}}P[h].agg_page_loads+=1,localStorage.setItem("gt:agg_cache_time_by_hour:"+N,JSON.stringify(P)),gtUtils.hashSHA1(b,20,function(T){O.urls[T]||(O.urls[T]=q);var U=gtUtils.timeDiffPeriods(O.urls[T],g);console.log(U);for(var V=0;V<U.length;V++)"min"!=U[V]&&p.push({ts:g,type:"page_visit_by_"+U[V],p:b,ref:f});O.urls[T]=g,O.site.last_visit||(O.site.last_visit=q);for(var U=gtUtils.timeDiffPeriods(O.site.last_visit,g),V=0;V<U.length;V++)if("min"!=U[V]){var W={ts:g,type:"site_visit_by_"+U[V],p:n};O.site.last_visit!=q&&(W.returning_from_ts=O.site.last_visit.slice(0,10)),p.push(W)}O.site.last_visit=g,localStorage.setItem("gt:site:"+N,JSON.stringify(O))})});var t=localStorage.getItem("gt:last_visit_in_any_site")||q;localStorage.setItem("gt:last_visit_in_any_site",g),t==q&&p.push({ts:g,type:"new_all"});for(var u=gtUtils.timeDiffPeriods(t,g),v=0;v<u.length;v++)if("min"!=u[v]){p.push({ts:g,type:"new_"+u[v],browser:"",os:"",ref:f})}var A=JSON.parse(localStorage.getItem("gt:history")||"[]");A.unshift([b,g]),A=A.slice(0,10);for(var B=-1,v=1;v<A.length;v++)if(60<gtUtils.timeDiffMinutes(g,A[v][1])){B=v;break}-1!=B&&(A=A.slice(0,B)),localStorage.setItem("gt:history",JSON.stringify(A));for(var C=A.slice(A.length-3,A.length),D=[],v=0;v<C.length;v++)40>gtUtils.timeDiffMinutes(g,C[v][1])&&D.push(C[v][0]);var E=[];if(0<D.length){for(var H,F=0,G=D[0].replace("http://","").split("/")[0],v=1;v<D.length;v++)H=D[v].replace("http://","").split("/")[0],H!=G&&(D[v]="(obfuscated)",F++,E.push([G,H]));var I=JSON.parse(localStorage.getItem("gt:cache_by_hour")||"{}");if(2<=D.length-F&&gtUtils.hashSHA1("patterns: "+D.join(" >> "),null,function(N){I[h]||(I={},I[h]={}),I[h][N]||(I[h][N]=!0,localStorage.setItem("gt:cache_by_hour",JSON.stringify(I)),p.push({ts:g,type:"pattern_by_hour",p:D}))}),0<E.length){var J=E[E.length-1];gtUtils.hashSHA1("correlation: "+J.join(" >> "),null,function(N){I[h]||(I={},I[h]={}),I[h][N]||(I[h][N]=!0,localStorage.setItem("gt:cache_by_hour",JSON.stringify(I)),p.push({ts:g,type:"site_correlation_by_hour",p:J}))})}}var L=JSON.parse(localStorage.getItem("gt:message-sent-demo-only")||"[]"),M=p.reverse().concat(L).slice(0,200);localStorage.setItem("gt:message-sent-demo-only",JSON.stringify(M)),gtUtils.sendAllPar(gtUtils.shuffleArray(p))},incomingMsg=function(a){var b=a.data.urlDetails;siteID=a.data.siteID,main(b),setInterval(function(){return function(c){var f=c.origin,g=gtUtils.getDate(),h=gtUtils.dateToTimestamp(g),k=h.slice(0,10);gtUtils.hashSHA1(f,20,function(l){var n=JSON.parse(localStorage.getItem("gt:agg_cache_time_by_hour:"+l)||"{}"),p=n[k];p&&p.hasOwnProperty("agg_page_time")&&(p.agg_page_time+=2,localStorage.setItem("gt:agg_cache_time_by_hour:"+l,JSON.stringify(n)))})}(b)},2e3)};window.addEventListener("message",incomingMsg,!1);var gtUtils=function(){var a={};a.getDate=function(){return new Date},a.sendAll=function(c){(function(f){if(0<f.length){var g=new XMLHttpRequest;g.open("POST",endPoint),g.setRequestHeader("Content-Type","application/json"),g.onreadystatechange=function(){4==g.readyState&&200==g.status&&0<f.length&&a.sendAll(f.slice(1,f.length))},g.send(JSON.stringify(c[0]))}})(c)},a.sendAllPar=function(c){(function(f){for(var h,g=0;g<f.length;g++){h=f[g],h.site_id=siteID;var k=new XMLHttpRequest;k.open("POST",endPoint),k.setRequestHeader("Content-Type","application/json"),k.onreadystatechange=function(){},k.send(JSON.stringify(h))}})(c)};var b=function(c){return c=""+parseInt(c),2>c.length&&(c="0"+c),c};return a.hashSHA1=function(c,f,g){sha1(c,function(h){f&&(h=h.slice(0,f)),g(h)})},a.timeDiffPeriods=function(c,f){for(var g=["year","month","day","hour","min"],h=[4,2,2,2,2],l=0,n=-1,p=0;p<g.length;p++){var q=c.slice(l,l+h[p]),t=f.slice(l,l+h[p]);if(q!=t){n=p;break}l+=h[p]}return-1==n?[]:g.slice(n,g.length)},a.timeDiffMinutes=function(c,f){var g=a.timestampToUTCDate(c).getTime()-a.timestampToUTCDate(f).getTime();return g/60000},a.timestampToUTCDate=function(c){return new Date(parseInt(c.slice(0,4))||0,parseInt(c.slice(4,6))||0,parseInt(c.slice(6,8))||0,parseInt(c.slice(8,10))||0,parseInt(c.slice(10,12))||0)},a.dateToTimestamp=function(c){var f=c.getUTCFullYear(),g=c.getUTCMonth()+1,h=c.getUTCDate(),k=c.getUTCHours(),l=c.getUTCMinutes();return f+b(g)+b(h)+b(k)+b(l)},a.shuffleArray=function(c){for(var f=c.length-1;0<f;f--){var g=Math.floor(Math.random()*(f+1)),h=c[f];c[f]=c[g],c[g]=h}return c},a.parseRef=function(c){var f="";return["google","yahoo","bing"].forEach(k=>{var l=/(?:)/;l.compile(k,"g"),c.match(l)&&(f=k)}),["twitter","t.co","facebook"].forEach(k=>{var l=/(?:)/;l.compile(k,"g"),c.match(l)&&(f=k)}),f},a}();
</script>